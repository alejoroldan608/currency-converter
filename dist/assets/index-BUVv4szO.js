(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))a(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const c of o.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&a(c)}).observe(document,{childList:!0,subtree:!0});function r(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerPolicy&&(o.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?o.credentials="include":n.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function a(n){if(n.ep)return;n.ep=!0;const o=r(n);fetch(n.href,o)}})();const g=["USD","EUR","COP","JPY","GBP","MXN","BRL","ARS","CLP","CAD","AUD","CHF"],p=new Map;function N(){return Date.now()}function S(t){return!t||t.expiresAt<=N()}function O(t,e,r){const a={value:e,expiresAt:N()+r};p.set(t,a);try{localStorage.setItem(t,JSON.stringify(a))}catch{}}function D(t){const e=p.get(t);if(!S(e))return e.value;try{const r=localStorage.getItem(t);if(!r)return null;const a=JSON.parse(r);return S(a)?(localStorage.removeItem(t),p.delete(t),null):(p.set(t,a),a.value)}catch{return null}}const C="https://api.exchangerate.host",B=1800*1e3;function I(t){return g.includes(t)}async function P(t,e){const r=e?.length?e:g,a=`api:rates:${t}:${r.join(",")}`,n=D(a);if(n)return{ok:!0,data:n};const o=new URLSearchParams({base:t});e?.length&&o.set("symbols",e.join(","));try{const c=await fetch(`${C}/latest?${o.toString()}`);if(!c.ok)return{ok:!1,error:`HTTP ${c.status}`,status:c.status};const s=await c.json(),i={};for(const[f,w]of Object.entries(s.rates??{}))I(f)&&(i[f]=Number(w));return O(a,i,B),{ok:!0,data:i}}catch(c){return{ok:!1,error:c?.message??"fetch error"}}}async function U(t,e,r){const a=new URLSearchParams({from:t,to:e,amount:String(r)});try{const n=await fetch(`${C}/convert?${a.toString()}`);if(!n.ok)return{ok:!1,error:`HTTP ${n.status}`,status:n.status};const o=await n.json(),c=Number(o.result);let s=Number(o.info?.rate);return!Number.isFinite(s)&&Number.isFinite(c)&&r>0&&(s=c/r),!Number.isFinite(s)||!Number.isFinite(c)||c<=0||s<=0?{ok:!1,error:"invalid data"}:{ok:!0,data:{rate:s,result:c}}}catch(n){return{ok:!1,error:n?.message??"fetch error"}}}async function F(t,e,r){const a=await U(t,e,r);if(a.ok){const{rate:s,result:i}=a.data;if(Number.isFinite(s)&&s>0&&Number.isFinite(i)&&i>0)return{ok:!0,data:{rate:s,value:i,source:"host-convert"}}}const n=await P(t,[e]);if(n.ok){const s=Number(n.data[e]);if(Number.isFinite(s)&&s>0)return{ok:!0,data:{rate:s,value:r*s,source:"host-latest"}}}try{const s=await fetch(`https://open.er-api.com/v6/latest/${t}`);if(s.ok){const i=await s.json(),f=Number(i.rates?.[e]);if(Number.isFinite(f)&&f>0)return{ok:!0,data:{rate:f,value:r*f,source:"erapi-latest"}}}}catch{}const o={"USD->COP":4e3,"EUR->COP":4400,"USD->EUR":.9,"EUR->USD":1.1,"USD->MXN":17,"USD->BRL":5,"USD->CLP":900,"USD->JPY":155,"USD->GBP":.78},c=`${t}->${e}`;if(o[c]){const s=o[c];return{ok:!0,data:{rate:s,value:r*s,source:"fallback-local"}}}return{ok:!1,error:"no-rate-found"}}class R extends Error{constructor(e,r){super(`[${e}] ${r??e}`),this.code=e,this.name="DomainError"}}function b(t,e,r=navigator.language){return new Intl.NumberFormat(r,{style:"currency",currency:e}).format(t)}const k=document.getElementById("baseCurrency"),T=document.getElementById("targetCurrency"),j=document.getElementById("amount"),x=document.getElementById("convertBtn"),A=document.getElementById("converterForm"),M=document.getElementById("result"),H=document.getElementById("status");function d(t,e){if(!t)throw new Error(`Elemento DOM no encontrado: ${e}`);return t}const u=d(k,"baseCurrency"),l=d(T,"targetCurrency"),h=d(j,"amount"),$=d(x,"convertBtn"),J=d(A,"converterForm"),Y=d(M,"result"),_=d(H,"status");function m(t){_.textContent=t}function v(t){Y.textContent=t}function E(t){$.disabled=t,$.textContent=t?"Convirtiendo…":"Convertir"}function q(t){const e=r=>`<option value="${r}">${r}</option>`;u.options.length===0&&(u.innerHTML=t.map(e).join(""),u.value="USD"),l.options.length===0&&(l.innerHTML=t.map(e).join(""),l.value="COP")}function G(){try{const t=localStorage.getItem("ui:last");if(!t)return;const{base:e,target:r}=JSON.parse(t);e&&g.includes(e)&&(u.value=e),r&&g.includes(r)&&(l.value=r)}catch{}}function L(){try{localStorage.setItem("ui:last",JSON.stringify({base:u.value,target:l.value}))}catch{}}function y(){const t=Number(h.value);return!Number.isFinite(t)||t<=0?"Ingresa un monto válido mayor que 0.":u.value===l.value?"Base y destino no pueden ser iguales.":null}[u,l].forEach(t=>t.addEventListener("change",()=>{L(),m(y()??"")}));h.addEventListener("input",()=>m(y()??""));J.addEventListener("submit",async t=>{t.preventDefault();const e=y();if(e){m(e),v("");return}const r=Number(h.value),a=u.value,n=l.value;E(!0),m("Consultando tasas…"),v("");try{const o=await F(a,n,r);if(console.debug("[convertAmount]",o),!o.ok){m(`No se pudo convertir (${o.error})`);return}const{rate:c,value:s,source:i}=o.data;L();const f=i==="fallback-local"?" — (tasa estimada)":"";v(`${b(r,a)} = ${b(s,n)} (tasa ${c.toFixed(4)}${f})`),m("Listo.")}catch(o){o instanceof R?m(`Error de datos: ${o.message}`):m("Ocurrió un error inesperado al convertir.")}finally{E(!1)}});q(g);G();m("Selecciona monedas e ingresa el monto para convertir.");console.debug("[init] opciones base:",u.options.length,"target:",l.options.length,"valores:",u.value,l.value);
